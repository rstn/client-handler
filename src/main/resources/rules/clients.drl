package rules

import com.simbirsoft.drools.clienthandler.model.DroolsClient
import com.simbirsoft.drools.clienthandler.model.ClientResult
import com.simbirsoft.drools.clienthandler.model.Subscriber
import function com.simbirsoft.drools.clienthandler.util.DroolsClientLogger.warn
import function com.simbirsoft.drools.clienthandler.util.DroolsClientLogger.error

rule "Sum subscribers spent"
  when
    $droolsClient: DroolsClient($client: client, $clientResult: clientResult);
    $total : Number() from accumulate(
           s: Subscriber() from $client.subscribers,
           sum(s.getSpent()))
  then
    $clientResult.setSpentTotal($total.longValue());
  end

rule "Is big client"
  when
    $client: DroolsClient(client.subscribers != null)
  then
    $client.getClientResult().setBig(client.subscribers.size() > 100);
  end

rule "Unknown type"
  when
    not DroolsClient()
    some: Object()
  then
    warn("Waited DroolsClient. Recive: " + some);
  end